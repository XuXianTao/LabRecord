<?php
$lines=[];
$machines=[];
$k=0;
function arr_push(&$array, $key, $obj) {
    if (array_key_exists($key,$array)){
        if (!in_array($obj,$array[$key]))
            array_push($array[$key], $obj);
    }
    else $array[$key] = [$obj];
}
foreach($excp_static as $k=>$obj) {
    switch ($obj['machine']) {
        case '实验箱': {
            arr_push($machines,'box_elec', $obj['typ']);
            arr_push($machines,'box_mode', $obj['typ']);
            arr_push($machines,'box_cir',$obj['typ']);
            break;
        }
        default: {
            arr_push($machines,MACHINE_STATIC[$obj['machine']],$obj['typ']);
            break;
        }
    }
    $lines[$obj['typ']][$obj['color']]=$obj['num'];
}

//dump($lines);
//dump($machines);

?>
  <div class="stu-excp">
    <div class="container">
      <div class="row">
        <div class="stu-excp-content">
          <h4>仪器异常反馈</h4>
          <button class="stu-excp__submit btn btn-lg btn-primary">异常汇报</button>
          <span class="stu-excp__ta-statu">[助理正在处理{某某位置}仪器]</span>/
          <span>[助理很闲]</span>
            <div class="card-columns">
            {foreach $machines as $machine=>$parts}
              <div class="card" id="{$machine}">
                <div class="card-block">
                  <h4 class="card-title">
                      {$Think.const.MACHINE_NAME[$machine]}
                  </h4>
                </div>
                <ul class="list-group list-group-flush">
                {foreach $parts as $i=>$part}
                  <li class="list-group-item">
                    {$part}:
                    {foreach $lines[$part] as $color=>$num}
                    {$color}
                    {/foreach}
                  </li>
                {/foreach}
                </ul>
              </div>
            {/foreach}
            </div>
          </div>
        </div>
      </div>
    </div>
